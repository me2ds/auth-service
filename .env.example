# Environment Variables Reference

## Configuration

### Application Settings
```
NODE_ENV=production|development|test
LOG_LEVEL=debug|info|warn|error
API_PORT=8000
API_HOST=0.0.0.0
```

### Authentication
```
JWT_SECRET=your-jwt-secret-key-here
JWT_EXPIRATION=7d
GITHUB_CLIENT_ID=github-client-id
GITHUB_CLIENT_SECRET=github-client-secret
DISCORD_CLIENT_ID=discord-client-id
DISCORD_CLIENT_SECRET=discord-client-secret
```

### Database
```
DATABASE_URL=postgresql://user:password@host:5432/desme_audio
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=desme_audio
DATABASE_USER=desme_user
DATABASE_PASSWORD=db-password
```

### Redis
```
REDIS_URL=redis://localhost:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=optional-redis-password
```

### Storage (S3)
```
STORAGE_TYPE=s3
AWS_REGION=us-west-2
AWS_S3_BUCKET=desme-audio-production
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_ENDPOINT_URL=optional-custom-s3-endpoint
```

### Performance
```
REQUEST_TIMEOUT_MS=30000
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
REDIS_CACHE_TTL_SECONDS=3600
```

### Features
```
COMPOSITION_PAGE_SIZE=20
HISTORY_PAGE_SIZE=50
MAX_FILE_SIZE_MB=100
MAX_FILES_PER_UPLOAD=5
ALLOWED_AUDIO_FORMATS=mp3,wav,flac,aac,m4a
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png,webp
```

### WebSocket
```
WEBSOCKET_PING_INTERVAL_MS=30000
WEBSOCKET_PING_TIMEOUT_MS=5000
```

### Security
```
CORS_ORIGINS=https://desme.app,https://api.desme.app
CORS_CREDENTIALS=true
```

### Monitoring
```
METRICS_ENABLED=true
PROMETHEUS_PATH=/metrics
```

## Development (.env.development)

```env
NODE_ENV=development
LOG_LEVEL=debug
API_PORT=8000
API_HOST=localhost

JWT_SECRET=dev-secret-key
JWT_EXPIRATION=7d

DATABASE_URL=postgresql://dev:dev@localhost:5432/desme_audio_dev
REDIS_URL=redis://localhost:6379/1

STORAGE_TYPE=s3
AWS_REGION=us-east-1
AWS_S3_BUCKET=desme-audio-dev
AWS_ACCESS_KEY_ID=dev-access-key
AWS_SECRET_ACCESS_KEY=dev-secret-key

GITHUB_CLIENT_ID=dev-github-id
GITHUB_CLIENT_SECRET=dev-github-secret
DISCORD_CLIENT_ID=dev-discord-id
DISCORD_CLIENT_SECRET=dev-discord-secret

CORS_ORIGINS=http://localhost:8000,http://localhost:3001
METRICS_ENABLED=false
```

## Testing (.env.test)

```env
NODE_ENV=test
LOG_LEVEL=error
API_PORT=3001

JWT_SECRET=test-secret-key
JWT_EXPIRATION=1h

DATABASE_URL=postgresql://test:test@localhost:5432/desme_audio_test
REDIS_URL=redis://localhost:6379/2

STORAGE_TYPE=s3
AWS_REGION=us-east-1
AWS_S3_BUCKET=desme-audio-test
AWS_ACCESS_KEY_ID=test-access-key
AWS_SECRET_ACCESS_KEY=test-secret-key

METRICS_ENABLED=false
```

## Production (.env.production)

> **IMPORTANT**: Never commit production secrets to version control!
> Use Kubernetes Secrets, AWS Systems Manager Parameter Store, or HashiCorp Vault

```env
NODE_ENV=production
LOG_LEVEL=info
API_PORT=8000
API_HOST=0.0.0.0

JWT_SECRET=<use-kubernetes-secret>
JWT_EXPIRATION=7d

DATABASE_URL=<use-kubernetes-secret>
REDIS_URL=<use-kubernetes-secret>

STORAGE_TYPE=s3
AWS_REGION=us-west-2
AWS_S3_BUCKET=desme-audio-production
AWS_ACCESS_KEY_ID=<use-kubernetes-secret>
AWS_SECRET_ACCESS_KEY=<use-kubernetes-secret>

GITHUB_CLIENT_ID=<use-kubernetes-secret>
GITHUB_CLIENT_SECRET=<use-kubernetes-secret>
DISCORD_CLIENT_ID=<use-kubernetes-secret>
DISCORD_CLIENT_SECRET=<use-kubernetes-secret>

CORS_ORIGINS=https://desme.app,https://api.desme.app
CORS_CREDENTIALS=true
METRICS_ENABLED=true
```

## Kubernetes Configuration

In Kubernetes, environment variables are provided via:

1. **ConfigMap** (non-sensitive):
   ```bash
   kubectl apply -f k8s/configmap.yaml
   ```

2. **Secrets** (sensitive - base64 encoded):
   ```bash
   kubectl apply -f k8s/secret.yaml
   ```

3. **Deployment manifest** maps them to container:
   ```yaml
   containers:
   - name: api
     env:
     - name: JWT_SECRET
       valueFrom:
         secretKeyRef:
           name: desme-audio-secrets
           key: JWT_SECRET
   ```

## Vercel Deployment

Set these environment variables in Vercel dashboard:

```
NODE_ENV=production
LOG_LEVEL=info
STORAGE_TYPE=s3
AWS_REGION=us-west-2
AWS_S3_BUCKET=desme-audio-production
AWS_ACCESS_KEY_ID=<your-key>
AWS_SECRET_ACCESS_KEY=<your-secret>
JWT_SECRET=<your-secret>
DATABASE_URL=<external-db-url>
REDIS_URL=<external-redis-url>
```

## Docker Compose (.env for compose.yml)

```env
NODE_ENV=development
LOG_LEVEL=debug
API_PORT=8000

JWT_SECRET=dev-secret
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/desme_audio
REDIS_URL=redis://redis:6379/0

STORAGE_TYPE=s3
AWS_REGION=us-east-1
AWS_S3_BUCKET=desme-audio-local
AWS_ACCESS_KEY_ID=minioadmin
AWS_SECRET_ACCESS_KEY=minioadmin
AWS_ENDPOINT_URL=http://minio:9000

GITHUB_CLIENT_ID=local-github-id
GITHUB_CLIENT_SECRET=local-github-secret
```

## Migration & Reference

### From npm to Bun

All environment variables remain the same. Update package.json scripts:

```json
{
  "scripts": {
    "start": "bun start",
    "dev": "bun start",
    "build": "bun run build:bun",
    "test": "bun test",
    "test:e2e": "bun test:e2e",
    "test:load": "k6 run test/load/playback.load.ts"
  }
}
```

### From Local Storage to S3

Update these environment variables:

```bash
# Change from local filesystem
# STORAGE_PATH=/uploads

# To S3
STORAGE_TYPE=s3
AWS_REGION=us-west-2
AWS_S3_BUCKET=desme-audio-production
AWS_ACCESS_KEY_ID=<your-key>
AWS_SECRET_ACCESS_KEY=<your-secret>
```

The application code automatically switches storage backend based on `STORAGE_TYPE`.
